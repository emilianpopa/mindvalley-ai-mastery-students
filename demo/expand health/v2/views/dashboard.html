<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - ExpandHealth</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cline x1='20' y1='20' x2='80' y2='80' stroke='%230F766E' stroke-width='12' stroke-linecap='round'/%3E%3Cline x1='80' y1='20' x2='20' y2='80' stroke='%230F766E' stroke-width='12' stroke-linecap='round'/%3E%3C/svg%3E">
  <link rel="stylesheet" href="/css/main.css">
  <!-- <link rel="stylesheet" href="/css/chat-widget.css"> -->
  <script src="/js/feature-flags.js"></script>
</head>
<body>
  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>

  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <!-- Mobile Close Button -->
      <button class="mobile-close-btn" onclick="closeMobileMenu()">
        <svg viewBox="0 0 24 24" fill="none">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
      <div class="sidebar-header">
        <div class="logo">
          <svg class="logo-icon" width="28" height="28" viewBox="0 0 24 24" fill="none">
            <path d="M4 4L11 12L4 20" stroke="#0F766E" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M20 4L13 12L20 20" stroke="#0F766E" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div class="logo-text">
            <span class="logo-expand">EXPAND</span>
            <span class="logo-health">HEALTH</span>
          </div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <a href="/" class="nav-item active">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
              </svg>
            </span>
            <span class="nav-text">Dashboard</span>
          </a>
          <a href="/inbox" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <polyline points="22,6 12,13 2,6"/>
              </svg>
            </span>
            <span class="nav-text">Inbox</span>
          </a>
          <a href="#" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                <line x1="8" y1="21" x2="16" y2="21"/>
                <line x1="12" y1="17" x2="12" y2="21"/>
              </svg>
            </span>
            <span class="nav-text">Point of sale</span>
          </a>
        </div>

        <div class="nav-section">
          <p class="nav-section-title">BOOKING</p>
          <a href="/schedule" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M3 3v18h18"/>
                <path d="M18 17V9"/>
                <path d="M13 17V5"/>
                <path d="M8 17v-3"/>
              </svg>
            </span>
            <span class="nav-text">Schedule</span>
          </a>
          <a href="/appointments" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
            </span>
            <span class="nav-text">Appointments</span>
          </a>
          <a href="#" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10"/>
                <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                <line x1="9" y1="9" x2="9.01" y2="9"/>
                <line x1="15" y1="9" x2="15.01" y2="9"/>
              </svg>
            </span>
            <span class="nav-text">Classes</span>
          </a>
          <a href="#" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
            </span>
            <span class="nav-text">Community</span>
          </a>
          <a href="#" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <polygon points="23 7 16 12 23 17 23 7"/>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
              </svg>
            </span>
            <span class="nav-text">On-Demand</span>
          </a>
          <a href="#" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
            </span>
            <span class="nav-text">Memberships</span>
          </a>
        </div>

        <div class="nav-section">
          <p class="nav-section-title">CUSTOMERS</p>
          <a href="/clients" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
            </span>
            <span class="nav-text">Customers</span>
          </a>
          <a href="/forms" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M9 11l3 3L22 4"/>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
              </svg>
            </span>
            <span class="nav-text">Forms</span>
          </a>
          <a href="/protocol-templates" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10 9 9 9 8 9"/>
              </svg>
            </span>
            <span class="nav-text">Protocol Templates</span>
          </a>
        </div>

        <div class="nav-section">
          <p class="nav-section-title">BUSINESS</p>
          <a href="#" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                <line x1="12" y1="22.08" x2="12" y2="12"/>
              </svg>
            </span>
            <span class="nav-text">Marketing</span>
          </a>
          <a href="#" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <line x1="18" y1="20" x2="18" y2="10"/>
                <line x1="12" y1="20" x2="12" y2="4"/>
                <line x1="6" y1="20" x2="6" y2="14"/>
              </svg>
            </span>
            <span class="nav-text">Analytics</span>
          </a>
          <a href="#" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
              </svg>
            </span>
            <span class="nav-text">Financials</span>
          </a>
        </div>

        <div class="nav-section">
          <p class="nav-section-title">ADMIN</p>
          <a href="/admin" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
              </svg>
            </span>
            <span class="nav-text">Studio set-up</span>
          </a>
          <a href="/kb-admin" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
            </span>
            <span class="nav-text">AI Knowledge Base</span>
          </a>
          <a href="#" class="nav-item">
            <span class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <line x1="3" y1="9" x2="21" y2="9"/>
                <line x1="9" y1="21" x2="9" y2="9"/>
              </svg>
            </span>
            <span class="nav-text">Apps & Integrations</span>
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <button class="ask-ai-btn" onclick="window.chatWidget && window.chatWidget.toggleChat()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
          <span>Ask AI</span>
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <!-- Mobile Menu Button -->
          <button class="mobile-menu-btn" onclick="openMobileMenu()">
            <svg viewBox="0 0 24 24" fill="none">
              <line x1="3" y1="6" x2="21" y2="6"/>
              <line x1="3" y1="12" x2="21" y2="12"/>
              <line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
          </button>
          <div>
            <h1>Dashboard</h1>
            <p class="breadcrumb">Home â†’ Dashboard</p>
          </div>
        </div>
        <div class="header-right">
          <div class="user-menu-wrapper">
            <button class="user-avatar-btn" onclick="toggleUserMenu()">
              <img src="https://ui-avatars.com/api/?name=Admin&background=0F766E&color=fff&size=40" alt="User" class="user-avatar" id="userAvatar">
            </button>
            <div class="user-dropdown" id="userDropdown">
              <div class="user-dropdown-header">
                <img src="https://ui-avatars.com/api/?name=Admin&background=0F766E&color=fff&size=40" alt="User" class="dropdown-avatar">
                <div class="dropdown-user-info">
                  <span class="dropdown-user-name" id="dropdownUserName">Admin User</span>
                  <span class="dropdown-user-email" id="dropdownUserEmail">admin@expandhealth.io</span>
                </div>
              </div>
              <div class="user-dropdown-divider"></div>
              <a href="/profile" class="user-dropdown-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                <span>My Profile</span>
              </a>
              <a href="/settings" class="user-dropdown-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
                <span>Settings</span>
              </a>
              <div class="user-dropdown-divider"></div>
              <button class="user-dropdown-item logout-item" onclick="handleLogout()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                  <polyline points="16 17 21 12 16 7"/>
                  <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                <span>Log Out</span>
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Dashboard Content - Momence Style -->
      <div class="content" style="display: flex; gap: 24px; padding: 24px;">
        <!-- Main Content Column -->
        <div style="flex: 1; min-width: 0;">
          <!-- Upcoming Appointments Section -->
          <div class="dashboard-card" style="background: white; border-radius: 12px; border: 1px solid #e5e7eb; margin-bottom: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #f3f4f6;">
              <h3 style="font-size: 16px; font-weight: 600; color: #1f2937; margin: 0;">Upcoming appointments</h3>
              <a href="/appointments" style="font-size: 13px; color: #0d9488; text-decoration: none;">Show all</a>
            </div>
            <div id="upcomingAppointmentsList" style="max-height: 400px; overflow-y: auto;">
              <div style="padding: 32px 20px; text-align: center; color: #9ca3af;">Loading appointments...</div>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="stats-grid" style="margin-bottom: 24px;">
            <div class="stat-card" style="border-left: 4px solid #0F766E;">
              <div class="stat-icon" style="background: #CCFBF1;">
                <svg viewBox="0 0 24 24" fill="none" stroke="#0F766E">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
              </div>
              <div class="stat-info">
                <h3 id="statTodayAppts">-</h3>
                <p>Today's Appointments</p>
              </div>
            </div>

            <div class="stat-card" style="border-left: 4px solid #3B82F6;">
              <div class="stat-icon" style="background: #DBEAFE;">
                <svg viewBox="0 0 24 24" fill="none" stroke="#3B82F6">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
              </div>
              <div class="stat-info">
                <h3 id="statUpcomingAppts">-</h3>
                <p>Upcoming (7 days)</p>
              </div>
            </div>

            <div class="stat-card" style="border-left: 4px solid #10B981;">
              <div class="stat-icon" style="background: #D1FAE5;">
                <svg viewBox="0 0 24 24" fill="none" stroke="#10B981">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
              </div>
              <div class="stat-info">
                <h3 id="statCompletedAppts">-</h3>
                <p>Completed (30 days)</p>
              </div>
            </div>

            <div class="stat-card" style="border-left: 4px solid #8B5CF6;">
              <div class="stat-icon" style="background: #EDE9FE;">
                <svg viewBox="0 0 24 24" fill="none" stroke="#8B5CF6">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                </svg>
              </div>
              <div class="stat-info">
                <h3 id="statClients">-</h3>
                <p>Total Customers</p>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="quick-actions">
            <h3>Quick Actions</h3>
            <div class="action-grid">
              <a href="/appointments" class="action-card" style="border-left: 3px solid #0F766E;">
                <span class="action-icon" style="background: #CCFBF1;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="#0F766E" stroke-width="1.5">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                    <line x1="12" y1="14" x2="12" y2="18"/>
                    <line x1="10" y1="16" x2="14" y2="16"/>
                  </svg>
                </span>
                <div>
                  <h4>Schedule Appointment</h4>
                  <p>Book a new session</p>
                </div>
              </a>

              <a href="/clients/new" class="action-card">
                <span class="action-icon">
                  <svg viewBox="0 0 24 24" fill="none">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                  </svg>
                </span>
                <div>
                  <h4>Add New Customer</h4>
                  <p>Create a new patient profile</p>
                </div>
              </a>

              <a href="/kb-admin" class="action-card">
                <span class="action-icon">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                  </svg>
                </span>
                <div>
                  <h4>Upload KB Document</h4>
                  <p>Add clinical protocols</p>
                </div>
              </a>

              <a href="/protocol-templates" class="action-card">
                <span class="action-icon">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                  </svg>
                </span>
                <div>
                  <h4>Create Protocol</h4>
                  <p>Build a treatment template</p>
                </div>
              </a>
            </div>
          </div>
        </div>

        <!-- Right Sidebar - Recent Activity -->
        <div class="activity-sidebar" style="width: 320px; flex-shrink: 0;">
          <div style="background: white; border-radius: 12px; border: 1px solid #e5e7eb; padding: 20px;">
            <h3 style="font-size: 14px; font-weight: 600; color: #1f2937; margin: 0 0 16px 0;" id="activityTitle">Recent activity</h3>
            <div id="recentActivityList">
              <div style="text-align: center; color: #9ca3af; font-size: 13px; padding: 24px 0;">Loading activity...</div>
            </div>
          </div>
        </div>
      </div>

      <style>
        /* Momence-style appointment items */
        .appointment-item {
          display: flex;
          align-items: flex-start;
          gap: 12px;
          padding: 16px 20px;
          border-bottom: 1px solid #f3f4f6;
          cursor: pointer;
          transition: background 0.15s;
        }
        .appointment-item:last-child { border-bottom: none; }
        .appointment-item:hover { background: #f9fafb; }
        .appointment-date {
          text-align: center;
          min-width: 100px;
        }
        .appointment-date-main {
          font-size: 13px;
          font-weight: 600;
          color: #1f2937;
        }
        .appointment-date-sub {
          font-size: 12px;
          color: #6b7280;
          margin-top: 2px;
        }
        .appointment-date-relative {
          font-size: 11px;
          color: #0d9488;
          margin-top: 4px;
          display: flex;
          align-items: center;
          gap: 4px;
        }
        .appointment-info { flex: 1; min-width: 0; }
        .appointment-title {
          font-size: 14px;
          font-weight: 500;
          color: #1f2937;
          margin-bottom: 4px;
        }
        .appointment-title a { color: #0d9488; text-decoration: none; }
        .appointment-title a:hover { text-decoration: underline; }
        .appointment-details { font-size: 13px; color: #6b7280; }
        .appointment-meta {
          display: flex;
          flex-direction: column;
          align-items: flex-end;
          gap: 4px;
        }
        .appointment-badge {
          display: inline-flex;
          align-items: center;
          gap: 4px;
          font-size: 11px;
          padding: 3px 8px;
          border-radius: 10px;
          font-weight: 500;
        }
        .appointment-badge.attendees { background: #e0f2fe; color: #0369a1; }
        .appointment-badge.unpaid { background: #fef3c7; color: #d97706; }
        .appointment-badge.paid { background: #dcfce7; color: #16a34a; }

        /* Activity feed styles */
        .activity-item {
          display: flex;
          gap: 12px;
          padding: 12px 0;
          border-bottom: 1px solid #f3f4f6;
        }
        .activity-item:last-child { border-bottom: none; }
        .activity-icon {
          width: 32px;
          height: 32px;
          border-radius: 50%;
          background: #dcfce7;
          display: flex;
          align-items: center;
          justify-content: center;
          flex-shrink: 0;
          color: #16a34a;
        }
        .activity-icon svg { width: 14px; height: 14px; }
        .activity-content { flex: 1; min-width: 0; }
        .activity-time { font-size: 11px; color: #9ca3af; margin-bottom: 4px; }
        .activity-text { font-size: 13px; color: #374151; line-height: 1.4; }
        .activity-text strong { font-weight: 600; color: #1f2937; }
        .activity-text a { color: #0d9488; text-decoration: none; }
        .activity-text a:hover { text-decoration: underline; }

        /* Responsive */
        @media (max-width: 1200px) {
          .activity-sidebar { display: none; }
          .content { flex-direction: column !important; }
        }
      </style>
    </main>
  </div>

  <script src="/js/dashboard.js"></script>
  <!-- Chat widget temporarily disabled - needs light theme update
  <script src="/js/chat-widget.js"></script>
  -->
  <script>
    // User Menu Toggle
    function toggleUserMenu() {
      const dropdown = document.getElementById('userDropdown');
      dropdown.classList.toggle('active');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const dropdown = document.getElementById('userDropdown');
      const wrapper = document.querySelector('.user-menu-wrapper');
      if (dropdown && wrapper && !wrapper.contains(event.target)) {
        dropdown.classList.remove('active');
      }
    });

    // Handle Logout
    function handleLogout() {
      if (confirm('Are you sure you want to log out?')) {
        localStorage.removeItem('auth_token');
        localStorage.removeItem('user');
        window.location.href = '/login';
      }
    }

    // Load user info into dropdown
    function loadUserInfo() {
      const userStr = localStorage.getItem('user');
      if (userStr) {
        try {
          const user = JSON.parse(userStr);
          const nameEl = document.getElementById('dropdownUserName');
          const emailEl = document.getElementById('dropdownUserEmail');
          const avatarEls = document.querySelectorAll('.user-avatar, .dropdown-avatar');

          if (nameEl && user.firstName) {
            nameEl.textContent = `${user.firstName} ${user.lastName || ''}`.trim();
          }
          if (emailEl && user.email) {
            emailEl.textContent = user.email;
          }

          // Update avatars
          const name = encodeURIComponent(`${user.firstName || 'U'} ${user.lastName || ''}`);
          avatarEls.forEach(el => {
            el.src = `https://ui-avatars.com/api/?name=${name}&background=0F766E&color=fff&size=40`;
          });
        } catch (e) {
          console.error('Error parsing user info:', e);
        }
      }
    }

    // Load user info on page load
    document.addEventListener('DOMContentLoaded', loadUserInfo);

    // Load upcoming appointments (Momence style)
    async function loadUpcomingAppointments() {
      const container = document.getElementById('upcomingAppointmentsList');
      if (!container) return;

      try {
        const response = await fetch('/api/appointments?upcoming=true&limit=5', {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('auth_token')}` }
        });

        if (!response.ok) throw new Error('Failed to load');
        const data = await response.json();
        const appointments = data.appointments || data || [];

        if (appointments.length === 0) {
          container.innerHTML = '<div style="padding: 32px 20px; text-align: center; color: #9ca3af;">No upcoming appointments</div>';
          return;
        }

        container.innerHTML = appointments.slice(0, 5).map(apt => {
          const startTime = new Date(apt.start_time || apt.startTime);
          const dateStr = startTime.toLocaleDateString('en-ZA', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
          const timeStr = startTime.toLocaleTimeString('en-ZA', { hour: '2-digit', minute: '2-digit' });
          const relativeTime = getRelativeTime(startTime);
          const clientName = apt.client?.first_name ? `${apt.client.first_name} ${apt.client.last_name || ''}` : 'Client';
          const serviceName = apt.service?.name || apt.title || 'Appointment';
          const staffName = apt.staff?.first_name ? `${apt.staff.first_name} ${apt.staff.last_name || ''}` : 'Staff';
          const isPaid = apt.payment_status === 'paid' || apt.paymentStatus === 'paid';

          return `
            <div class="appointment-item" onclick="window.location.href='/appointments?id=${apt.id}'">
              <div class="appointment-date">
                <div class="appointment-date-main">${dateStr}</div>
                <div class="appointment-date-sub">${timeStr}</div>
                <div class="appointment-date-relative">
                  <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  ${relativeTime}
                </div>
              </div>
              <div class="appointment-info">
                <div class="appointment-title">
                  Expand Health - <a href="#">${serviceName}</a>
                </div>
                <div class="appointment-details">
                  with ${staffName} - ${clientName}
                </div>
              </div>
              <div class="appointment-meta">
                <span class="appointment-badge attendees">ðŸ‘¤ 1 attendee</span>
                <span class="appointment-badge ${isPaid ? 'paid' : 'unpaid'}">${isPaid ? 'Paid' : 'Not paid'}</span>
              </div>
            </div>
          `;
        }).join('');

      } catch (error) {
        console.error('Error loading appointments:', error);
        container.innerHTML = '<div style="padding: 32px 20px; text-align: center; color: #9ca3af;">Failed to load appointments</div>';
      }
    }

    // Load recent activity
    async function loadRecentActivity() {
      const container = document.getElementById('recentActivityList');
      const titleEl = document.getElementById('activityTitle');
      if (!container) return;

      try {
        const response = await fetch('/api/appointments?limit=10&orderBy=created_at', {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('auth_token')}` }
        });

        if (!response.ok) throw new Error('Failed to load');
        const data = await response.json();
        const appointments = data.appointments || data || [];

        if (appointments.length === 0) {
          if (titleEl) titleEl.textContent = 'No recent activity';
          container.innerHTML = '<div style="text-align: center; color: #9ca3af; font-size: 13px; padding: 24px 0;">No activity to show yet.</div>';
          return;
        }

        if (titleEl) titleEl.textContent = 'Recent activity';

        container.innerHTML = appointments.slice(0, 8).map(apt => {
          const createdAt = new Date(apt.created_at || apt.createdAt || new Date());
          const relativeTime = getRelativeTime(createdAt);
          const clientName = apt.client?.first_name ? `${apt.client.first_name} ${apt.client.last_name || ''}` : 'A customer';
          const serviceName = apt.service?.name || apt.title || 'an appointment';

          return `
            <div class="activity-item">
              <div class="activity-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <path d="M20 6L9 17l-5-5"></path>
                </svg>
              </div>
              <div class="activity-content">
                <div class="activity-time">${relativeTime}</div>
                <div class="activity-text">
                  <strong>${clientName}</strong><br>
                  Booked an appointment to <a href="#">${serviceName}</a>
                </div>
              </div>
            </div>
          `;
        }).join('');

      } catch (error) {
        console.error('Error loading activity:', error);
        container.innerHTML = '<div style="text-align: center; color: #9ca3af; font-size: 13px; padding: 24px 0;">Failed to load activity</div>';
      }
    }

    // Helper function to get relative time
    function getRelativeTime(date) {
      const now = new Date();
      const diffMs = date - now;
      const diffMins = Math.round(diffMs / 60000);
      const diffHours = Math.round(diffMs / 3600000);
      const diffDays = Math.round(diffMs / 86400000);

      if (diffMs < 0) {
        // Past
        const absMins = Math.abs(diffMins);
        const absHours = Math.abs(diffHours);
        const absDays = Math.abs(diffDays);
        if (absMins < 60) return `${absMins} min ago`;
        if (absHours < 24) return `${absHours} hours ago`;
        return `${absDays} days ago`;
      } else {
        // Future
        if (diffMins < 60) return `in ${diffMins} min`;
        if (diffHours < 24) return `in ${diffHours} hours`;
        if (diffDays === 0) return 'today';
        if (diffDays === 1) return 'in a day';
        return `in ${diffDays} days`;
      }
    }

    // Load data on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadUpcomingAppointments();
      loadRecentActivity();
    });

    // Mobile Menu Functions
    function openMobileMenu() {
      document.getElementById('sidebar').classList.add('mobile-open');
      document.getElementById('mobileOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeMobileMenu() {
      document.getElementById('sidebar').classList.remove('mobile-open');
      document.getElementById('mobileOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    // Close mobile menu when clicking a nav link
    document.querySelectorAll('.sidebar .nav-item').forEach(link => {
      link.addEventListener('click', () => {
        if (window.innerWidth <= 768) {
          closeMobileMenu();
        }
      });
    });
  </script>
</body>
</html>
