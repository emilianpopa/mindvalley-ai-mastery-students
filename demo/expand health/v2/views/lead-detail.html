<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lead Details - ExpandHealth</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cline x1='20' y1='20' x2='80' y2='80' stroke='%230F766E' stroke-width='12' stroke-linecap='round'/%3E%3Cline x1='80' y1='20' x2='20' y2='80' stroke='%230F766E' stroke-width='12' stroke-linecap='round'/%3E%3C/svg%3E">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/js/feature-flags.js"></script>
  <style>
    .main-content {
      flex: 1;
      margin-left: 260px;
      overflow-y: auto;
      background: #f8f9fa;
    }

    .lead-detail-page {
      padding: 24px 32px;
    }

    /* Back Button */
    .back-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--gray-600);
      text-decoration: none;
      font-size: 0.875rem;
    }

    .back-link:hover {
      color: var(--gray-900);
    }

    .back-link svg {
      width: 20px;
      height: 20px;
    }

    /* Page Header */
    .lead-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 24px;
    }

    .lead-title-section h1 {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--gray-900);
      margin-bottom: 8px;
    }

    .converted-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.875rem;
      color: var(--gray-600);
    }

    .converted-link {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: #EEF2FF;
      color: #6366F1;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.813rem;
    }

    .converted-link:hover {
      background: #E0E7FF;
    }

    .header-buttons {
      display: flex;
      gap: 12px;
    }

    .btn-edit {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: #6366F1;
      border: none;
      border-radius: 8px;
      font-size: 0.875rem;
      color: white;
      font-weight: 500;
      cursor: pointer;
    }

    .btn-edit:hover {
      background: #4F46E5;
    }

    .actions-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: white;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      font-size: 0.875rem;
      color: var(--gray-700);
      cursor: pointer;
    }

    .actions-btn:hover {
      background: var(--gray-50);
    }

    /* Content Layout */
    .lead-content {
      display: flex;
      gap: 24px;
    }

    /* Left Panel - Lead Info */
    .lead-info-panel {
      width: 320px;
      flex-shrink: 0;
    }

    .info-card {
      background: white;
      border-radius: 12px;
      border: 1px solid var(--gray-200);
      padding: 20px;
    }

    .lead-contact-header {
      text-align: center;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--gray-100);
      margin-bottom: 20px;
    }

    .lead-name {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--gray-900);
      margin-bottom: 4px;
    }

    .lead-email {
      font-size: 0.875rem;
      color: #6366F1;
    }

    .info-row {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--gray-100);
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-icon {
      width: 32px;
      height: 32px;
      background: #FDF2F8;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .info-icon svg {
      width: 16px;
      height: 16px;
      color: #DB2777;
    }

    .info-icon.purple {
      background: #EEF2FF;
    }

    .info-icon.purple svg {
      color: #6366F1;
    }

    .info-content {
      flex: 1;
    }

    .info-label {
      font-size: 0.75rem;
      color: #DB2777;
      margin-bottom: 2px;
    }

    .info-label.purple {
      color: #6366F1;
    }

    .info-value {
      font-size: 0.875rem;
      color: var(--gray-900);
    }

    .info-value a {
      color: #6366F1;
      text-decoration: none;
    }

    .info-value a:hover {
      text-decoration: underline;
    }

    /* Right Panel - Activity */
    .activity-panel {
      flex: 1;
    }

    .activity-card {
      background: white;
      border-radius: 12px;
      border: 1px solid var(--gray-200);
    }

    .activity-tabs {
      display: flex;
      border-bottom: 1px solid var(--gray-200);
    }

    .activity-tab {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 16px 20px;
      font-size: 0.875rem;
      color: var(--gray-500);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      background: none;
      border-top: none;
      border-left: none;
      border-right: none;
    }

    .activity-tab:hover {
      color: var(--gray-700);
    }

    .activity-tab.active {
      color: #6366F1;
      border-bottom-color: #6366F1;
      font-weight: 500;
    }

    .activity-tab svg {
      width: 16px;
      height: 16px;
    }

    .activity-content {
      padding: 24px;
    }

    /* Timeline */
    .timeline {
      position: relative;
    }

    .timeline-item {
      display: flex;
      gap: 16px;
      padding-bottom: 24px;
      position: relative;
    }

    .timeline-item:last-child {
      padding-bottom: 0;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: 15px;
      top: 32px;
      bottom: 0;
      width: 2px;
      background: var(--gray-200);
    }

    .timeline-item:last-child::before {
      display: none;
    }

    .timeline-icon {
      width: 32px;
      height: 32px;
      background: #EEF2FF;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      z-index: 1;
    }

    .timeline-icon svg {
      width: 16px;
      height: 16px;
      color: #6366F1;
    }

    .timeline-content {
      flex: 1;
      padding-top: 4px;
    }

    .timeline-time {
      font-size: 0.75rem;
      color: var(--gray-400);
      margin-bottom: 4px;
    }

    .timeline-title {
      font-size: 0.875rem;
      color: var(--gray-900);
      margin-bottom: 2px;
    }

    .timeline-title a {
      color: #6366F1;
      text-decoration: none;
    }

    .timeline-title a:hover {
      text-decoration: underline;
    }

    .timeline-subtitle {
      font-size: 0.813rem;
      color: var(--gray-500);
    }

    .timeline-subtitle a {
      color: #6366F1;
      text-decoration: none;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray-500);
    }

    .empty-state svg {
      width: 48px;
      height: 48px;
      margin-bottom: 12px;
      color: var(--gray-300);
    }

    /* Edit Lead Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: white;
      border-radius: 12px;
      width: 100%;
      max-width: 420px;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid var(--gray-200);
    }

    .modal-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--gray-900);
    }

    .modal-close {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--gray-400);
      border-radius: 8px;
    }

    .modal-close:hover {
      background: var(--gray-100);
      color: var(--gray-600);
    }

    .modal-body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray-700);
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      font-size: 0.875rem;
      box-sizing: border-box;
    }

    .form-input:focus {
      outline: none;
      border-color: #6366F1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .form-select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      font-size: 0.875rem;
      background: white;
      cursor: pointer;
      box-sizing: border-box;
    }

    .form-select:focus {
      outline: none;
      border-color: #6366F1;
    }

    .phone-input-group {
      display: flex;
      gap: 8px;
    }

    .phone-country {
      width: 80px;
      flex-shrink: 0;
    }

    .phone-country .form-select {
      padding: 10px 8px;
    }

    .phone-number {
      flex: 1;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      padding: 16px 24px;
      border-top: 1px solid var(--gray-200);
      background: white;
    }

    .btn-cancel {
      padding: 10px 20px;
      background: white;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      font-size: 0.875rem;
      color: var(--gray-700);
      cursor: pointer;
    }

    .btn-cancel:hover {
      background: var(--gray-50);
    }

    .btn-save {
      padding: 10px 24px;
      background: #6366F1;
      border: none;
      border-radius: 8px;
      font-size: 0.875rem;
      color: white;
      font-weight: 500;
      cursor: pointer;
    }

    .btn-save:hover {
      background: #4F46E5;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <svg class="logo-icon" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="8" y1="8" x2="32" y2="32" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <line x1="32" y1="8" x2="8" y2="32" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
          </svg>
          <div class="logo-text">
            <span class="logo-expand">EXPAND</span>
            <span class="logo-health">HEALTH</span>
          </div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <a href="/" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect></svg>
          <span>Dashboard</span>
        </a>
        <a href="/inbox" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
          <span>Inbox</span>
        </a>
        <a href="/pos" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
          <span>Point of sale</span>
        </a>
        <a href="/classes" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          <span>Classes</span>
        </a>
        <a href="/appointments" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          <span>Appointments</span>
        </a>
        <a href="/community" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
          <span>Community</span>
        </a>
        <a href="/on-demand" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
          <span>On-Demand</span>
        </a>
        <a href="/memberships" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
          <span>Memberships</span>
        </a>
        <a href="/clients" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
          <span>Customers</span>
        </a>
        <a href="/leads" class="nav-item active">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>
          <span>Marketing</span>
        </a>
        <a href="/analytics" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
          <span>Analytics</span>
        </a>
        <a href="/financials" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>
          <span>Financials</span>
        </a>

        <div class="nav-section-title">STUDIO SET-UP</div>
        <a href="/studio/practitioners" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
          <span>Practitioners</span>
        </a>
        <a href="/services" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
          <span>Services</span>
        </a>
        <a href="/studio/locations" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
          <span>Locations</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <div class="support-links">
          <a href="#" class="support-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
            </svg>
            <span>Support</span>
          </a>
          <a href="#" class="support-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
              <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            <span>Help center</span>
          </a>
        </div>
        <a href="/settings" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
          <span>Settings</span>
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="lead-detail-page">
        <!-- Back Button & Actions -->
        <div class="back-row">
          <a href="/leads" class="back-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            <span id="leadName">Loading...</span>
          </a>
        </div>

        <!-- Lead Header -->
        <div class="lead-header">
          <div class="lead-title-section">
            <h1 id="leadNameTitle">Loading...</h1>
            <div class="converted-badge" id="convertedBadge" style="display: none;">
              Converted customer:
              <a href="#" class="converted-link" id="customerLink">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span id="customerName"></span>
              </a>
            </div>
          </div>
          <div class="header-buttons">
            <button class="btn-edit" onclick="openEditModal()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
              Edit
            </button>
            <button class="actions-btn" onclick="toggleActionsMenu()">
              Actions
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="12" cy="5" r="1"></circle>
                <circle cx="12" cy="19" r="1"></circle>
              </svg>
            </button>
          </div>
        </div>

        <!-- Content -->
        <div class="lead-content">
          <!-- Left Panel - Lead Info -->
          <div class="lead-info-panel">
            <div class="info-card">
              <div class="lead-contact-header">
                <div class="lead-name" id="contactName">Loading...</div>
                <div class="lead-email" id="contactEmail">Loading...</div>
              </div>

              <div class="info-row">
                <div class="info-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                </div>
                <div class="info-content">
                  <div class="info-label">Assigned staff</div>
                  <div class="info-value" id="assignedStaff">None</div>
                </div>
              </div>

              <div class="info-row">
                <div class="info-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                </div>
                <div class="info-content">
                  <div class="info-label">Created at</div>
                  <div class="info-value" id="createdAt">Loading...</div>
                </div>
              </div>

              <div class="info-row">
                <div class="info-icon purple">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                  </svg>
                </div>
                <div class="info-content">
                  <div class="info-label purple">Source</div>
                  <div class="info-value"><a href="#" id="sourceLink">Loading...</a></div>
                </div>
              </div>

              <div class="info-row">
                <div class="info-icon purple">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                    <polyline points="22,6 12,13 2,6"></polyline>
                  </svg>
                </div>
                <div class="info-content">
                  <div class="info-label purple">Number of messages sent</div>
                  <div class="info-value" id="messageCount">0</div>
                </div>
              </div>

              <div class="info-row">
                <div class="info-icon purple">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                  </svg>
                </div>
                <div class="info-content">
                  <div class="info-label purple">Lead stage</div>
                  <div class="info-value" id="leadStage">No stage assigned</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Panel - Activity -->
          <div class="activity-panel">
            <div class="activity-card">
              <div class="activity-tabs">
                <button class="activity-tab active" onclick="switchTab('activity')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                  </svg>
                  Activity
                </button>
                <button class="activity-tab" onclick="switchTab('messages')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                  </svg>
                  Messages
                </button>
                <button class="activity-tab" onclick="switchTab('notes')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                  </svg>
                  Notes
                </button>
                <button class="activity-tab" onclick="switchTab('tasks')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11l3 3L22 4"></path>
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                  </svg>
                  Tasks
                </button>
              </div>

              <div class="activity-content" id="activityContent">
                <!-- Activity Timeline -->
                <div class="timeline" id="activityTimeline">
                  <!-- Timeline items will be rendered here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Edit Lead Modal -->
  <div class="modal-overlay" id="editLeadModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Edit lead</h2>
        <button class="modal-close" onclick="closeEditModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">First name</label>
          <input type="text" class="form-input" id="editFirstName" placeholder="First name">
        </div>

        <div class="form-group">
          <label class="form-label">Last name</label>
          <input type="text" class="form-input" id="editLastName" placeholder="Last name">
        </div>

        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="editEmail" placeholder="email@example.com">
        </div>

        <div class="form-group">
          <label class="form-label">Phone number</label>
          <div class="phone-input-group">
            <div class="phone-country">
              <select class="form-select" id="editPhoneCountry">
                <option value="+27">ðŸ‡¿ðŸ‡¦ +27</option>
                <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
                <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
                <option value="+61">ðŸ‡¦ðŸ‡º +61</option>
                <option value="+49">ðŸ‡©ðŸ‡ª +49</option>
              </select>
            </div>
            <div class="phone-number">
              <input type="tel" class="form-input" id="editPhone" placeholder="Phone number">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">ZIP code</label>
          <input type="text" class="form-input" id="editZipCode" placeholder="ZIP code">
        </div>

        <div class="form-group">
          <label class="form-label">How did you find out about us?</label>
          <input type="text" class="form-input" id="editReferral" placeholder="">
        </div>

        <div class="form-group">
          <label class="form-label">Source</label>
          <select class="form-select" id="editSource">
            <option value="dashboard">Dashboard</option>
            <option value="paid_meta_ads">Paid Meta Ads (FB/Instagram)</option>
            <option value="endpoint_api">Endpoint (API)</option>
            <option value="abandoned_checkout">Abandoned checkout</option>
            <option value="missed_call">Missed call</option>
            <option value="incoming_call">Incoming call</option>
            <option value="incoming_sms">Incoming sms</option>
            <option value="webchat">Webchat</option>
            <option value="whatsapp_general">Whatsapp (general)</option>
            <option value="whatsapp_meta_ads">Whatsapp (meta ads)</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="closeEditModal()">Cancel</button>
        <button class="btn-save" onclick="saveLeadEdit()">Save</button>
      </div>
    </div>
  </div>

  <script>
    // Sample lead data (in real app, this would come from API)
    const leadsData = {
      1: {
        id: 1,
        name: 'Maryna Rheeder',
        email: 'rheedermaryna@gmail.com',
        phone: '',
        created: '2025-02-12',
        source: 'Abandoned checkout',
        sourceLink: '/abandoned-checkout',
        messages: 0,
        stage: 'No stage assigned',
        staff: 'None',
        converted: true,
        customerName: 'Maryna Rheeder',
        customerId: 101,
        activity: [
          { type: 'converted', time: 'a year ago', title: 'Lead converted to customer', link: '/clients/101', linkText: 'Maryna Rheeder' },
          { type: 'created', time: 'a year ago', title: 'Lead created', subtitle: 'Source', subtitleLink: '/abandoned-checkout', subtitleLinkText: 'Abandoned checkout' }
        ]
      },
      2: {
        id: 2,
        name: 'Ben Hillman',
        email: 'hillman_ben@hotmail.com',
        phone: '',
        created: '2025-02-09',
        source: 'Abandoned checkout',
        sourceLink: '/abandoned-checkout',
        messages: 0,
        stage: 'No stage assigned',
        staff: 'None',
        converted: false,
        activity: [
          { type: 'created', time: 'a year ago', title: 'Lead created', subtitle: 'Source', subtitleLink: '/abandoned-checkout', subtitleLinkText: 'Abandoned checkout' }
        ]
      },
      3: {
        id: 3,
        name: 'Jill Isaacs',
        email: 'jilleye6@gmail.com',
        phone: '',
        created: '2025-02-03',
        source: 'Abandoned checkout',
        sourceLink: '/abandoned-checkout',
        messages: 0,
        stage: 'No stage assigned',
        staff: 'None',
        converted: false,
        activity: [
          { type: 'created', time: 'a year ago', title: 'Lead created', subtitle: 'Source', subtitleLink: '/abandoned-checkout', subtitleLinkText: 'Abandoned checkout' }
        ]
      }
    };

    // Get lead ID from URL
    const pathParts = window.location.pathname.split('/');
    const leadId = parseInt(pathParts[pathParts.length - 1]) || 1;
    const lead = leadsData[leadId] || leadsData[1];

    function renderLead() {
      document.getElementById('leadName').textContent = lead.name;
      document.getElementById('leadNameTitle').textContent = lead.name;
      document.getElementById('contactName').textContent = lead.name;
      document.getElementById('contactEmail').textContent = lead.email;
      document.getElementById('assignedStaff').textContent = lead.staff;
      document.getElementById('createdAt').textContent = formatDate(lead.created);
      document.getElementById('sourceLink').textContent = lead.source;
      document.getElementById('sourceLink').href = lead.sourceLink;
      document.getElementById('messageCount').textContent = lead.messages;
      document.getElementById('leadStage').textContent = lead.stage;

      if (lead.converted) {
        document.getElementById('convertedBadge').style.display = 'flex';
        document.getElementById('customerName').textContent = lead.customerName;
        document.getElementById('customerLink').href = `/clients/${lead.customerId}`;
      }

      renderTimeline(lead.activity);
    }

    function renderTimeline(activities) {
      const timeline = document.getElementById('activityTimeline');

      if (!activities || activities.length === 0) {
        timeline.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
            <p>No activity yet</p>
          </div>
        `;
        return;
      }

      timeline.innerHTML = activities.map(activity => `
        <div class="timeline-item">
          <div class="timeline-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              ${activity.type === 'converted' ?
                '<path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><polyline points="17 11 19 13 23 9"></polyline>' :
                '<path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line>'
              }
            </svg>
          </div>
          <div class="timeline-content">
            <div class="timeline-time">${activity.time}</div>
            <div class="timeline-title">
              ${activity.title}
              ${activity.link ? `<a href="${activity.link}">${activity.linkText}</a>` : ''}
            </div>
            ${activity.subtitle ? `
              <div class="timeline-subtitle">
                ${activity.subtitle} <a href="${activity.subtitleLink}">${activity.subtitleLinkText}</a>
              </div>
            ` : ''}
          </div>
        </div>
      `).join('');
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    function switchTab(tab) {
      // Update tab buttons
      document.querySelectorAll('.activity-tab').forEach(t => t.classList.remove('active'));
      event.target.closest('.activity-tab').classList.add('active');

      // Update content
      const content = document.getElementById('activityContent');

      if (tab === 'activity') {
        renderTimeline(lead.activity);
      } else if (tab === 'messages') {
        content.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
            <p>No messages sent yet</p>
          </div>
        `;
      } else if (tab === 'notes') {
        content.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            <p>No notes added yet</p>
          </div>
        `;
      } else if (tab === 'tasks') {
        content.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M9 11l3 3L22 4"></path>
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            <p>No tasks assigned yet</p>
          </div>
        `;
      }
    }

    function toggleActionsMenu() {
      alert('Actions menu coming soon!');
    }

    // Edit Modal Functions
    function openEditModal() {
      // Parse name into first and last
      const nameParts = lead.name.split(' ');
      const firstName = nameParts[0] || '';
      const lastName = nameParts.slice(1).join(' ') || '';

      // Populate form
      document.getElementById('editFirstName').value = firstName;
      document.getElementById('editLastName').value = lastName;
      document.getElementById('editEmail').value = lead.email || '';
      document.getElementById('editPhone').value = lead.phone ? lead.phone.replace(/^\+\d+\s*/, '') : '';
      document.getElementById('editZipCode').value = lead.zipCode || '';
      document.getElementById('editReferral').value = lead.referral || '';

      // Set source dropdown
      const sourceMap = {
        'Dashboard': 'dashboard',
        'Paid Meta Ads (FB/Instagram)': 'paid_meta_ads',
        'Endpoint (API)': 'endpoint_api',
        'Abandoned checkout': 'abandoned_checkout',
        'Missed call': 'missed_call',
        'Incoming call': 'incoming_call',
        'Incoming sms': 'incoming_sms',
        'Webchat': 'webchat',
        'Whatsapp (general)': 'whatsapp_general',
        'Whatsapp (meta ads)': 'whatsapp_meta_ads'
      };
      document.getElementById('editSource').value = sourceMap[lead.source] || 'dashboard';

      // Show modal
      document.getElementById('editLeadModal').classList.add('active');
    }

    function closeEditModal() {
      document.getElementById('editLeadModal').classList.remove('active');
    }

    function saveLeadEdit() {
      // Get form values
      const firstName = document.getElementById('editFirstName').value;
      const lastName = document.getElementById('editLastName').value;
      const email = document.getElementById('editEmail').value;
      const phoneCountry = document.getElementById('editPhoneCountry').value;
      const phone = document.getElementById('editPhone').value;
      const zipCode = document.getElementById('editZipCode').value;
      const referral = document.getElementById('editReferral').value;
      const sourceValue = document.getElementById('editSource').value;

      // Map source value back to display name
      const sourceDisplayMap = {
        'dashboard': 'Dashboard',
        'paid_meta_ads': 'Paid Meta Ads (FB/Instagram)',
        'endpoint_api': 'Endpoint (API)',
        'abandoned_checkout': 'Abandoned checkout',
        'missed_call': 'Missed call',
        'incoming_call': 'Incoming call',
        'incoming_sms': 'Incoming sms',
        'webchat': 'Webchat',
        'whatsapp_general': 'Whatsapp (general)',
        'whatsapp_meta_ads': 'Whatsapp (meta ads)'
      };

      // Update lead data
      lead.name = `${firstName} ${lastName}`.trim();
      lead.email = email;
      lead.phone = phone ? `${phoneCountry} ${phone}` : '';
      lead.zipCode = zipCode;
      lead.referral = referral;
      lead.source = sourceDisplayMap[sourceValue];

      // Re-render the page
      renderLead();

      // Close modal
      closeEditModal();

      // Show success message
      alert('Lead updated successfully!');
    }

    // Close modal on overlay click
    document.getElementById('editLeadModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeEditModal();
      }
    });

    // Check for edit param in URL
    function checkEditParam() {
      const params = new URLSearchParams(window.location.search);
      if (params.get('edit') === 'true') {
        openEditModal();
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      renderLead();
      checkEditParam();
    });
  </script>
</body>
</html>
